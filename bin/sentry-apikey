#!/usr/bin/env ruby

require_relative '../lib/jsonserver'

module SentryConfig
  module_eval File.read(File.join(File.dirname($0), "..", "etc", "config"))
end

$DEBUG = true

uid = ARGV[0]

if !uid
  STDERR.puts "Usage: #{File.basename $0} <uid>"
  STDERR.puts "  Create an api key for the given uid."
  exit 1
end

registry = JSONServerClientRegistry.new(SentryConfig::Daemon::REGISTRY)

if registry.uid? uid
  STDERR.puts "uid '#{uid}' already exists."
  exit 2
end

key = registry.create(uid)
puts key
